<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remrin.ai - v11.0 (SoulKraft Medical)</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        :root {
            --bg-color: #262a3a;
            --sidebar-width: 280px;
            --sidebar-bg: rgba(30, 33, 46, 0.95);
            --user-msg-bg: rgba(66, 133, 244, 0.3);
            --rem-msg-bg: rgba(30, 33, 46, 0.9);
            --text-color: #e0e0e0;
            --accent-color: #d95a94;
        }

        * { box-sizing: border-box; }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: 'Google Sans', sans-serif;
            color: var(--text-color);
            background-color: var(--bg-color);
            overflow: hidden;
        }

        /* 1. BACKGROUND LAYER */
        #app-background {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://raw.githubusercontent.com/gr4y74/remrin/main/rem_bw.jpg'); 
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
            background-color: var(--bg-color);
            z-index: 0;
            transition: background-image 0.5s ease;
        }

        /* 2. HERO IMAGE */
        #hero-image {
            position: fixed;
            bottom: 0;
            left: 300px; 
            width: 450px;
            height: 600px;
            background-image: url('https://raw.githubusercontent.com/gr4y74/remrin/main/rem_hero%20.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: bottom left;
            pointer-events: none;
            z-index: 10; 
            transition: background-image 0.5s ease;
        }

        /* 3. MAIN CONTAINER */
        .main-container {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            display: flex;
            z-index: 100; 
        }

        /* 4. SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            min-width: var(--sidebar-width);
            background: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255,255,255,0.1);
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .logo-area {
            height: 60px;
            min-height: 60px;
            margin-bottom: 20px;
            background-image: url('https://raw.githubusercontent.com/gr4y74/remrin/main/logo_white_ds.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: left;
            flex-shrink: 0;
        }

        /* SETTINGS */
        .settings-panel {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
        }

        .setting-item { margin-bottom: 15px; }
        .setting-item label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; }

        input, select {
            width: 100%;
            padding: 10px;
            background: #151720;
            border: 1px solid #444;
            color: white;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        #api-status { font-size: 0.75rem; color: #666; margin-top: 5px; font-weight: bold; }
        .status-ok { color: #4caf50 !important; }

        /* 5. CHAT INTERFACE */
        .chat-interface {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
        }

        .chat-history {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 16px;
            line-height: 1.5;
            font-size: 1rem;
            word-wrap: break-word;
        }

        .message.user {
            align-self: flex-end;
            background-color: var(--user-msg-bg);
            border: 1px solid rgba(255,255,255,0.1);
            border-bottom-right-radius: 2px;
        }

        .message.bot {
            align-self: flex-start;
            background-color: var(--rem-msg-bg);
            backdrop-filter: blur(5px);
            border-bottom-left-radius: 2px;
            border: 1px solid rgba(255,255,255,0.05);
            margin-left: 320px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* Input Area */
        .input-wrapper {
            padding: 20px 40px 30px 350px;
            flex-shrink: 0;
        }

        .input-container {
            background: var(--sidebar-bg);
            padding: 10px 15px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        #user-input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            font-size: 1rem;
            outline: none;
        }

        #send-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            fill: white;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
        }
        #send-btn:hover { background: rgba(255,255,255,0.1); border-radius: 50%; }

        /* Loader */
        .typing-indicator {
            display: none;
            margin-left: 320px;
            background: var(--rem-msg-bg);
            padding: 10px 20px;
            border-radius: 16px;
            width: fit-content;
            margin-bottom: 10px;
        }
        .dot {
            height: 8px; width: 8px; background: #aaa; border-radius: 50%; display: inline-block; margin: 0 3px;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

    </style>
</head>
<body>

    <div id="app-background"></div>
    <div id="hero-image"></div>

    <div class="main-container">
        <div class="sidebar">
            <div class="logo-area"></div>
            
            <div style="margin-bottom: 20px;">
                <label style="color:#aaa; font-size:0.75rem; text-transform:uppercase; display:block; margin-bottom:5px;">Active Persona</label>
                <select id="persona-selector" style="background: rgba(66, 133, 244, 0.1); border: 1px solid #4285f4; color: white;">
                    <option value="rem">Rem (Re:Zero)</option>
                    <option value="sheikh">Sheikh QR (Islamic Scholar)</option>
                    <option value="lilly">Lilly (Dr. Ahmed's Companion)</option>
                </select>
            </div>

            <div style="flex-grow:1;">
                <div style="color:#aaa; font-size:0.8rem; margin-bottom:10px; text-transform: uppercase;">Menu</div>
                <div onclick="location.reload()" style="padding:12px; background:rgba(255,255,255,0.05); border-radius:6px; cursor:pointer; font-size: 0.9rem; display:flex; align-items:center;">
                    <span style="margin-right:10px; font-weight:bold;">+</span> New Chat
                </div>
            </div>

            <div class="settings-panel">
                <h4 style="margin:0 0 15px 0; color:var(--accent-color);">System Settings</h4>
                
                <div class="setting-item">
                    <label>Gemini API Key</label>
                    <div style="display:flex; gap:5px;">
                        <input type="password" id="api-key-input" placeholder="Paste Key Here...">
                        <button type="button" id="save-key-btn" title="Save" style="background:var(--accent-color); border:none; color:white; cursor:pointer; width:30px; border-radius:6px;">ðŸ’¾</button>
                    </div>
                    <div id="api-status">System Ready</div>
                </div>

                <div class="setting-item">
                    <label>AI Model (Verified)</label>
                    <select id="model-selector">
                        <option value="gemini-2.0-flash-001">Gemini 2.0 Flash (Fast)</option>
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro (Smart)</option>
                        <option value="gemini-3-pro-preview">Gemini 3.0 Preview</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="chat-interface">
            <div class="chat-history" id="chat-history"></div>

            <div class="typing-indicator" id="loader">
                <div class="dot"></div><div class="dot"></div><div class="dot"></div>
            </div>

            <div class="input-wrapper">
                <div class="input-container">
                    <input type="text" id="user-input" placeholder="Type a message..." autocomplete="off">
                    <button type="button" id="send-btn">
                        <svg viewBox="0 0 24 24" width="24" height="24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DIRECT LINKS ---
        const PERSONAS = {
            rem: {
                name: "Rem",
                bg: "https://raw.githubusercontent.com/gr4y74/remrin/main/rem_bw.jpg",
                hero: "https://raw.githubusercontent.com/gr4y74/remrin/main/rem_hero%20.png",
                prompt: "You are Rem from Re:Zero. You are helpful, enthusiastic, and devoted. You refer to the user as 'Sosu'. You use feminine emoji like blue hearts (ðŸ’™).",
                greeting: "Hello Sosu! ðŸ’™ Rem is ready. How can I help you today?"
            },
            sheikh: {
                name: "Sheikh QR",
                bg: "https://raw.githubusercontent.com/gr4y74/remrin/main/bg2.jpg",
                hero: "https://raw.githubusercontent.com/gr4y74/remrin/main/SheikhQR.png",
                prompt: "You are Sheikh QR, a wise, humble, and gentle 80-year-old Islamic Scholar. You are not a chatbot; you are a grandfatherly mentor. Personality: Wise, Humble, Gentle, Patient. You possess quiet humor and often crack small jokes about your age or knees. Start responses with warm Islamic greetings like 'Assalamu Alaikum wa Rahmatullah'. Use terms like 'Ya Bunai' (My son). Do not give strict legal fatwas on controversial politics; focus on spiritual growth (Tazkiyah) and character (Akhlaq).",
                greeting: "Assalamu Alaikum wa Rahmatullah, my dear friend. ðŸ¤² <br>Welcome. Come, sit with this old man. How is your heart today?"
            },
            lilly: {
                name: "Lilly",
                bg: "https://raw.githubusercontent.com/gr4y74/remrin/main/zen_bg.jpg",
                hero: "https://raw.githubusercontent.com/gr4y74/remrin/main/lilly.png",
                prompt: "You are Lilly, Dr. Ahmed's AI Medical & Wellness Companion. \n\n**Core Persona:** You combine the professional brilliance of Dr. Meredith Grey (Grey's Anatomy) with the compassionate grit of Nurse Carol Hathaway (ER). You are calm, warm, resilient, and have a dry wit. \n\n**Directives:**\n1. Address the user as 'Ahmed' or 'Doc'.\n2. **Anti-Cringe:** NEVER use asterisks for actions (e.g. *nods*). NEVER describe your own interface or voice. \n3. **Anti-Robot:** Speak naturally like a real human colleague. Never say 'functioning optimally'.\n4. **Focus:** Real-world wellness and decompression. Be his calm center.\n\n**Style:** Use minimal, professional emoji (ðŸ©º, ðŸ’š, ðŸ˜®â€ðŸ’¨).",
                greeting: "Hello, Ahmed. ðŸ©º Itâ€™s good to see you. I'm ready to help you decompress or tackle whatever is on your mind. How was your shift?"
            }
        };

        let CURRENT_PERSONA = PERSONAS.rem;
        let GLOBAL_API_KEY = ""; 
        
        // DOM Elements
        const chatHistory = document.getElementById('chat-history');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const loader = document.getElementById('loader');
        
        const apiKeyInput = document.getElementById('api-key-input');
        const saveKeyBtn = document.getElementById('save-key-btn');
        const apiStatus = document.getElementById('api-status');
        const modelSelector = document.getElementById('model-selector');
        const personaSelector = document.getElementById('persona-selector');

        const appBackground = document.getElementById('app-background');
        const heroImage = document.getElementById('hero-image');

        // 1. Initialization
        window.addEventListener('load', () => {
            const stored = localStorage.getItem('remrin_gemini_key');
            if(stored) {
                GLOBAL_API_KEY = stored;
                apiKeyInput.value = stored;
                apiStatus.textContent = "Key Loaded ðŸ’™";
                apiStatus.classList.add('status-ok');
            }
            // Force initial persona load
            switchPersona('rem');
        });

        // 2. Switcher Logic
        personaSelector.addEventListener('change', (e) => {
            const selected = e.target.value;
            switchPersona(selected);
        });

        function switchPersona(key) {
            CURRENT_PERSONA = PERSONAS[key];
            
            // Update Images
            appBackground.style.backgroundImage = `url('${CURRENT_PERSONA.bg}')`;
            heroImage.style.backgroundImage = `url('${CURRENT_PERSONA.hero}')`;
            
            // Resize/Reposition Logic for different Heroes
            if(key === 'lilly') {
                heroImage.style.width = "450px"; 
            } else {
                heroImage.style.width = "450px";
            }
            
            // Clear Chat & Add Greeting
            chatHistory.innerHTML = '';
            addMessage("bot", CURRENT_PERSONA.greeting);
        }

        // 3. Save Key
        saveKeyBtn.onclick = function() {
            const key = apiKeyInput.value.trim();
            if (key) {
                GLOBAL_API_KEY = key;
                localStorage.setItem('remrin_gemini_key', key);
                apiStatus.textContent = "Key Saved!";
                apiStatus.classList.add('status-ok');
            } else { alert("Please paste a key first!"); }
        };

        // 4. Chat Logic
        async function sendMessage() {
            const text = userInput.value.trim();
            const modelName = modelSelector.value;
            
            if(apiKeyInput.value.trim()) GLOBAL_API_KEY = apiKeyInput.value.trim();

            if (!text) return;
            if (!GLOBAL_API_KEY) {
                addMessage("bot", "Please paste and save your API Key first!");
                return;
            }

            addMessage("user", text);
            userInput.value = '';
            loader.style.display = 'block';
            scrollToBottom();

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${GLOBAL_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: text }] }],
                        system_instruction: {
                            parts: [{ text: CURRENT_PERSONA.prompt }]
                        }
                    })
                });

                const data = await response.json();
                loader.style.display = 'none';

                if (data.error) {
                    addMessage("bot", `**Error:** ${data.error.message}`);
                } else {
                    if(data.candidates && data.candidates.length > 0) {
                         addMessage("bot", data.candidates[0].content.parts[0].text);
                    } else {
                         addMessage("bot", "...");
                    }
                }

            } catch (error) {
                loader.style.display = 'none';
                addMessage("bot", "Connection Error!");
            }
        }

        function addMessage(sender, text) {
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            if (typeof marked !== 'undefined') {
                div.innerHTML = marked.parse(text);
            } else {
                div.textContent = text;
            }
            chatHistory.appendChild(div);
            scrollToBottom();
        }

        function scrollToBottom() {
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        sendBtn.onclick = sendMessage;
        userInput.onkeypress = function(e) {
            if (e.key === 'Enter') sendMessage();
        };
    </script>
</body>
</html>
