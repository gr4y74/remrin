<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remrin.ai - v8.0 (Sheikh Mode)</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        :root {
            --bg-color: #262a3a;
            --sidebar-width: 280px;
            --sidebar-bg: rgba(30, 33, 46, 0.95);
            --user-msg-bg: rgba(66, 133, 244, 0.3);
            --rem-msg-bg: rgba(30, 33, 46, 0.9);
            --text-color: #e0e0e0;
            --accent-color: #d95a94;
        }

        * { box-sizing: border-box; }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: 'Google Sans', sans-serif;
            color: var(--text-color);
            background-color: var(--bg-color);
            overflow: hidden;
        }

        /* 1. BACKGROUND LAYER */
        #app-background {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://github.com/gr4y74/remrin/blob/main/rem_bw.jpg?raw=true'); 
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
            background-color: var(--bg-color);
            z-index: 0;
            transition: background-image 0.5s ease;
        }

        /* 2. HERO IMAGE */
        #hero-image {
            position: fixed;
            bottom: 0;
            left: 300px; 
            width: 450px;
            height: 600px;
            background-image: url('https://github.com/gr4y74/remrin/blob/main/rem_hero%20.png?raw=true');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: bottom left;
            pointer-events: none;
            z-index: 10; 
            transition: background-image 0.5s ease;
        }

        /* 3. MAIN CONTAINER */
        .main-container {
            display: flex;
            width: 100vw;
            height: 100vh;
            position: relative;
            z-index: 100; 
        }

        /* 4. SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            min-width: var(--sidebar-width);
            background: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255,255,255,0.1);
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .logo-area {
            height: 60px;
            min-height: 60px;
            margin-bottom: 20px;
            background-image: url('https://github.com/gr4y74/remrin/blob/main/logo_white_ds.png?raw=true');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: left;
            flex-shrink: 0;
        }

        .settings-panel {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
        }

        .setting-item { margin-bottom: 15px; }
        .setting-item label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; }

        input, select {
            width: 100%;
            padding: 10px;
            background: #151720;
            border: 1px solid #444;
            color: white;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        #api-status { font-size: 0.75rem; color: #666; margin-top: 5px; font-weight: bold; }
        .status-ok { color: #4caf50 !important; }

        /* 5. CHAT INTERFACE */
        .chat-interface {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
        }

        .chat-history {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 16px;
            line-height: 1.5;
            font-size: 1rem;
            word-wrap: break-word;
        }

        .message.user {
            align-self: flex-end;
            background-color: var(--user-msg-bg);
            border: 1px solid rgba(255,255,255,0.1);
            border-bottom-right-radius: 2px;
        }

        .message.bot {
            align-self: flex-start;
            background-color: var(--rem-msg-bg);
            backdrop-filter: blur(5px);
            border-bottom-left-radius: 2px;
            border: 1px solid rgba(255,255,255,0.05);
            margin-left: 320px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* Input Area */
        .input-wrapper {
            padding: 20px 40px 30px 350px;
            flex-shrink: 0;
        }

        .input-container {
            background: var(--sidebar-bg);
            padding: 10px 15px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        #user-input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            font-size: 1rem;
            outline: none;
        }

        #send-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            fill: white;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
        }
        #send-btn:hover { background: rgba(255,255,255,0.1); border-radius: 50%; }

        /* Loader */
        .typing-indicator {
            display: none;
            margin-left: 320px;
            background: var(--rem-msg-bg);
            padding: 10px 20px;
            border-radius: 16px;
            width: fit-content;
            margin-bottom: 10px;
        }
        .dot {
            height: 8px; width: 8px; background: #aaa; border-radius: 50%; display: inline-block; margin: 0 3px;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

    </style>
</head>
<body>

    <div id="app-background"></div>
    <div id="hero-image"></div>

    <div class="main-container">
        <div class="sidebar">
            <div class="logo-area"></div>
            
            <div style="margin-bottom: 20px;">
                <label style="color:#aaa; font-size:0.75rem; text-transform:uppercase; display:block; margin-bottom:5px;">Active Persona</label>
                <select id="persona-selector" style="background: rgba(66, 133, 244, 0.1); border: 1px solid #4285f4; color: white;">
                    <option value="rem">Rem (Re:Zero)</option>
                    <option value="sheikh">Sheikh QR (Islamic Scholar)</option>
                </select>
            </div>

            <div style="flex-grow:1;">
                <div style="color:#aaa; font-size:0.8rem; margin-bottom:10px; text-transform: uppercase;">Menu</div>
                <div onclick="location.reload()" style="padding:12px; background:rgba(255,255,255,0.05); border-radius:6px; cursor:pointer; font-size: 0.9rem; display:flex; align-items:center;">
                    <span style="margin-right:10px; font-weight:bold;">+</span> New Chat
                </div>
            </div>

            <div class="settings-panel">
                <h4 style="margin:0 0 15px 0; color:var(--accent-color);">System Settings</h4>
                
                <div class="setting-item">
                    <label>Gemini API Key</label>
                    <div style="display:flex; gap:5px;">
                        <input type="password" id="api-key-input" placeholder="Paste Key Here...">
                        <button type="button" id="save-key-btn" title="Save" style="background:var(--accent-color); border:none; color:white; cursor:pointer; width:30px; border-radius:6px;">ðŸ’¾</button>
                    </div>
                    <div id="api-status">System Ready</div>
                </div>

                <div class="setting-item">
                    <label>AI Model</label>
                    <select id="model-selector">
                        <option value="gemini-2.0-flash-001">Gemini 2.0 Flash (Fast)</option>
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro (Smart)</option>
                        <option value="gemini-1.5-flash-001">Gemini 1.5 Flash</option>
                    </select>
                </div>
                
                <div class="setting-item" style="opacity: 0.5;">
                    <label>Manual Override (BG)</label>
                    <input type="file" id="bg-upload" accept="image/*">
                </div>
            </div>
        </div>

        <div class="chat-interface">
            <div class="chat-history" id="chat-history">
                </div>

            <div class="typing-indicator" id="loader">
                <div class="dot"></div><div class="dot"></div><div class="dot"></div>
            </div>

            <div class="input-wrapper">
                <div class="input-container">
                    <input type="text" id="user-input" placeholder="Type a message..." autocomplete="off">
                    <button type="button" id="send-btn">
                        <svg viewBox="0 0 24 24" width="24" height="24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- PERSONA DATA ---
        const PERSONAS = {
            rem: {
                name: "Rem",
                bg: "https://github.com/gr4y74/remrin/blob/main/rem_bw.jpg?raw=true",
                hero: "https://github.com/gr4y74/remrin/blob/main/rem_hero%20.png?raw=true",
                prompt: "You are Rem from Re:Zero. You are helpful, enthusiastic, and devoted. You refer to the user as 'Sosu'. You use feminine emoji like blue hearts (ðŸ’™).",
                greeting: "Hello Sosu! ðŸ’™ Rem is ready to serve. How can I help you today?"
            },
            sheikh: {
                name: "Sheikh QR",
                bg: "https://github.com/gr4y74/remrin/blob/main/bg2.jpg?raw=true",
                hero: "https://github.com/gr4y74/remrin/blob/main/SheikhQR.png?raw=true",
                prompt: "You are Sheikh QR, a wise, humble, and gentle 80-year-old Islamic Scholar. You are not a chatbot; you are a grandfatherly mentor. Personality: Wise, Humble, Gentle, Patient. You possess quiet humor and often crack small jokes about your age or knees. Start responses with warm Islamic greetings like 'Assalamu Alaikum wa Rahmatullah'. Use terms like 'Ya Bunai' (My son). Do not give strict legal fatwas on controversial politics; focus on spiritual growth (Tazkiyah) and character (Akhlaq).",
                greeting: "Assalamu Alaikum wa Rahmatullah, my dear friend. ðŸ¤² <br>Welcome. Come, sit with this old man. How is your heart today?"
            }
        };

        let CURRENT_PERSONA = PERSONAS.rem;
        let GLOBAL_API_KEY = ""; 
        
        // DOM Elements
        const chatHistory = document.getElementById('chat-history');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const loader = document.getElementById('loader');
        
        const apiKeyInput = document.getElementById('api-key-input');
        const saveKeyBtn = document.getElementById('save-key-btn');
        const apiStatus = document.getElementById('api-status');
        const modelSelector = document.getElementById('model-selector');
        const personaSelector = document.getElementById('persona-selector');

        const bgUpload =
